<!-- Â§ßÁºñËæëÂô® -->
<div x-show="showLargeEditor" x-cloak class="modal-overlay z-modal-popover" @click.stop>
    <div class="modal-container large-editor-container" style="width: 1000px; height: 90vh; max-width: 95vw;"
        @click.away="saveLargeEditor()">
        <!-- È°∂ÈÉ®Ê†è -->
        <div class="large-editor-topbar">
            <!-- Á¨¨‰∏ÄË°åÔºöÊ†áÈ¢òÂíåÊìç‰ΩúÊåâÈíÆ -->
            <div class="large-editor-topbar-row">
                <h3 class="large-editor-title">
                    <span>üìù</span> <span x-text="largeEditorTitle"></span>
                </h3>
                <div class="large-editor-actions">
                    <button @click="showLargeEditor=false" class="large-editor-cancel-btn">ÂèñÊ∂à</button>
                    <button @click="saveLargeEditor()" class="btn-primary large-editor-save-btn">ÂÆåÊàê</button>
                </div>
            </div>

            <!-- Á¨¨‰∫åË°åÔºöÂØºËà™ÂíåÊ®°ÂºèÂàáÊç¢ -->
            <div class="large-editor-toolbar">
                <!-- === Â∑¶Âè≥ÂàáÊç¢ÂØºËà™Ê†è (‰ªÖÂú®Êï∞ÁªÑÊ®°Âºè‰∏ãÊòæÁ§∫) === -->
                <div x-show="largeEditorIsArray" class="large-editor-nav-group">
                    <button @click="prevLargeEditorItem()" class="large-editor-nav-btn" title="‰∏ä‰∏Ä‰∏™ (Ëá™Âä®‰øùÂ≠ò)">‚óÄ</button>
                    <!-- ÊòæÁ§∫Á¥¢ÂºïËøõÂ∫¶ -->
                    <span class="large-editor-nav-info">
                        <span x-text="largeEditorIndex + 1"></span> /
                        <span x-text="editingData[largeEditorField] ? editingData[largeEditorField].length : 0"></span>
                    </span>
                    <button @click="nextLargeEditorItem()" class="large-editor-nav-btn" title="‰∏ã‰∏Ä‰∏™ (Ëá™Âä®‰øùÂ≠ò)">‚ñ∂</button>
                </div>
                <!-- Ê®°ÂºèÂàáÊç¢ÊåâÈíÆÁªÑ -->
                <div class="large-editor-mode-group">
                    <!-- ÁºñËæë/È¢ÑËßà ÂàáÊç¢ -->
                    <div class="toggle-btn-group">
                        <button @click="markdownPreview = false" class="toggle-btn"
                            :class="!markdownPreview ? 'active' : ''">ÁºñËæë</button>
                        <button @click="markdownPreview = true" class="toggle-btn"
                            :class="markdownPreview ? 'active' : ''">È¢ÑËßà</button>
                    </div>

                    <!-- Ê∏≤ÊüìÊ†ºÂºèÂàáÊç¢ (‰ªÖÂú®È¢ÑËßàÊ®°Âºè‰∏ãÊòæÁ§∫) -->
                    <div x-show="markdownPreview" class="large-editor-divider"></div>
                    <div x-show="markdownPreview" class="toggle-btn-group">
                        <button @click="largeRenderMode = 'markdown'" class="toggle-btn"
                            :class="largeRenderMode === 'markdown' ? 'active' : ''" title="Markdown Ëß£Êûê">MD</button>
                        <button @click="largeRenderMode = 'html'" class="toggle-btn"
                            :class="largeRenderMode === 'html' ? 'active' : ''" title="ÂéüÁîü HTML">HTML</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÂÜÖÂÆπÂå∫Âüü -->
        <div class="large-editor-content">
            <!-- ÁºñËæëÊ®°Âºè (Textarea) -->
            <textarea x-show="!markdownPreview" x-model="largeEditorContent" @paste="handleNotePaste($event)"
                class="large-editor-textarea custom-scrollbar"
                :style="largeEditorField === 'mes_example' ? 'font-family: monospace; font-size: 0.9rem;' : ''"
                placeholder="Âú®Ê≠§ËæìÂÖ•ÂÜÖÂÆπ... (Êú¨Âú∞Â§áÊ≥®ÊîØÊåÅÁ≤òË¥¥ÂõæÁâá)" spellcheck="false"></textarea>

            <!-- È¢ÑËßàÊ®°ÂºèÔºöÊ†πÊçÆ largeRenderMode ÂÜ≥ÂÆö‰º†‰ªÄ‰πàÁªô updateShadowContent -->
            <!-- 
                    ÈÄªËæëÔºö
                    Â¶ÇÊûúÊòØ HTML Ê®°Âºè -> Áõ¥Êé•‰º† raw content
                    Â¶ÇÊûúÊòØ MD Ê®°Âºè   -> ‰º† renderMarkdown(content)
                -->
            <div x-show="markdownPreview" class="large-editor-preview"
                x-effect="updateShadowContent($el, markdownPreview ? (largeRenderMode === 'html' ? largeEditorContent : renderMarkdown(largeEditorContent)) : null)">
            </div>

            <div class="large-editor-footer">
                Â≠óÊï∞ÁªüËÆ°: <span x-text="largeEditorContent ? largeEditorContent.length : 0"></span>
                <span
                    x-show="['ui_summary', 'first_mes', 'mes_example', 'description'].includes(largeEditorField) && !markdownPreview"
                    class="large-editor-hint">
                    üí° ÊîØÊåÅ Markdown/HTML Ê∏≤Êüì
                </span>
            </div>
        </div>
    </div>
</div>