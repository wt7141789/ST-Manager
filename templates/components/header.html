<div class="header-bar" x-data="header">
    <div style="display: flex; align-items: center; gap: 1rem; flex: 1;">
        <!-- 移动端侧边栏切换按钮 -->
        <button class="mobile-menu-btn block md:hidden p-2 rounded-lg hover:bg-[var(--bg-hover)] mr-2" 
                @click="$store.global.mobileSidebarOpen = !$store.global.mobileSidebarOpen">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
        </button>

        <div style="display: flex; align-items: center; gap: 0.5rem;">
            <div class="app-icon" style="background: linear-gradient(135deg, var(--accent-main), #7c3aed); border-radius: 8px; padding: 0.5rem;">
                <span style="font-size: 1.5rem;">🎴</span>
            </div>
            <div>
                <span style="font-weight: bold; font-size: 1.125rem; white-space: nowrap;">ST Manager</span>
                <span style="font-size: 0.75rem; background: var(--accent-main); color: white; padding:2px 6px; border-radius:4px; margin-left: 0.25rem;">Docker V1.1</span>
            </div>
        </div>
        
        <!-- 递归过滤开关 - 添加动画效果 -->
        <div x-show="currentMode === 'cards'"
            class="filter-toggle flex items-center gap-2 ml-4 px-3 py-1.5 rounded-full border shadow-sm transition-all duration-300"
            :class="recursiveFilter ? 'bg-accent-faint border-accent-main' : 'bg-bg-sub border-border-light'"
            @click="recursiveFilter = !recursiveFilter; fetchCards()">
            <span class="text-xs cursor-pointer select-none font-medium" style="color: var(--text-sub);">
                包含子目录
            </span>
            <button type="button"
                class="relative inline-flex h-5 w-9 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out"
                :style="{ backgroundColor: recursiveFilter ? 'var(--accent-main)' : 'var(--bg-hover)' }"
                role="switch" :aria-checked="recursiveFilter">
                <span aria-hidden="true"
                    class="pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"
                    :class="recursiveFilter ? 'translate-x-4' : 'translate-x-0'">
                </span>
            </button>
        </div>
        
        <!-- 筛选标签云 - 添加悬停效果 -->
        <div style="display: flex; gap: 0.5rem; overflow-x: auto; margin-left: 1rem; flex: 1;" class="custom-scrollbar">
            <template x-for="tag in filterTags" :key="tag">
                <div class="filter-chip hover:scale-105 transition-transform" @click="toggleFilterTag(tag)">
                    <span x-text="tag"></span><span style="opacity: 0.8;">✕</span>
                </div>
            </template>
        </div>
    </div>
    
    <!-- 顶部右侧 - 优化布局和视觉效果 -->
    <div style="display: flex; align-items: center; gap: 0.5rem;">
        <!-- 选中状态栏 -->
        <div x-show="selectedIds.length > 0" class="selection-bar flex items-center gap-4 border px-3 py-1.5 rounded-lg mr-2"
            style="background-color: var(--accent-faint); border-color: var(--accent-light);">
            <button @click.stop="openBatchTagModal()" class="text-xs px-2 py-1 rounded text-white"
                style="background-color: #7c3aed; transition: all 0.2s;">
                批量标签
            </button>
            <button @click="deleteSelectedCards()"
                class="text-xs bg-red-800 hover:bg-red-700 px-2 py-1 rounded text-white border border-red-600/50 transition-all">
                🗑️ 移至回收站
            </button>
            <span class="text-sm text-accent">已选 <span x-text="selectedIds.length" class="font-bold"></span></span>
            <button @click="selectedIds = []" class="text-xs hover:text-white cursor-pointer"
                style="color: var(--text-sub);">取消</button>
        </div>
        
        <!-- 收藏筛选按钮 - 添加动画 -->
        <div class="flex items-center gap-1">
            <button @click="$store.global.viewState.filterFavorites = !$store.global.viewState.filterFavorites; fetchCards()"
                :class="$store.global.viewState.filterFavorites ? 'text-yellow-400 bg-yellow-400/10 border-yellow-400/50 scale-110' : 'text-gray-500 border-transparent hover:text-yellow-400 hover:scale-105'"
                class="btn-secondary transition-all" style="padding: 0.5rem; border: 1px solid; position: relative;"
                title="只显示收藏卡片">
                <span>★</span>
                <!-- 收藏激活时的光晕效果 -->
                <div x-show="$store.global.viewState.filterFavorites" 
                    class="absolute inset-0 rounded-full bg-yellow-400/20 animate-ping"></div>
            </button>
            
            <!-- 一键检测收藏卡片更新 -->
            <button x-show="currentMode === 'cards'"
                @click="checkAllFavUpdates()"
                class="btn-secondary transition-all hover:scale-105 relative"
                style="padding: 0.5rem; border: 1px solid var(--border-light);"
                :title="isCheckingFavs ? '检测中...' : '一键检测收藏卡片更新 (仅检测 Chub.ai/Discord)'"
                :disabled="isCheckingFavs">
                <span :class="isCheckingFavs ? 'animate-spin' : ''" style="display: inline-block;">🔄</span>
                <span x-show="favUpdateCount > 0" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] rounded-full w-4 h-4 flex items-center justify-center font-bold" x-text="favUpdateCount" style="z-index: 10;"></span>
            </button>
        </div>
        
        <!-- 搜索组合框 - 优化样式 -->
        <div class="search-container ml-auto mr-4">
            <select x-show="currentMode === 'cards'" x-model="searchType" class="search-select">
                <option value="mix">✨ 智能混合</option>
                <option value="global">🌍 全局关键字</option>
                <option value="name">👤 角色名称</option>
                <option value="filename">📄 文件名</option>
                <option value="creator">🎨 创作者</option>
                <option value="tags">🏷️ 标签</option>
            </select>
            <input x-show="currentMode === 'cards'" type="text" x-model.debounce.300ms="searchQuery"
                placeholder="搜索角色卡..." class="search-input" autocomplete="off">
            <input x-show="currentMode === 'worldinfo'" type="text" x-model.debounce.300ms="wiSearchQuery"
                placeholder="搜索世界书名称..." class="search-input" autocomplete="off">
            <button x-show="searchQuery" @click="searchQuery=''"
                style="background: transparent; color: var(--text-dim); border: none; padding: 0 0.5rem; cursor: pointer;">✕</button>
        </div>
        
        <!-- 工具按钮组 - 添加悬停效果 -->
        <div class="tool-buttons" style="display: flex; gap: 0.5rem; margin-left: 0.5rem;">
            <!-- 随机抽卡按钮 -->
            <button @click="currentMode === 'cards' ? randomCard() : randomWorldInfo()"
                :title="currentMode === 'cards' ? '🎲 手气不错，随机角色' : '🎲 手气不错，随机世界书'"
                class="hover:scale-110 transition-transform active:rotate-180 duration-300"
                style="padding: 0.5rem; background: linear-gradient(135deg, var(--accent-main), #7c3aed); border: 1px solid var(--accent-light); border-radius: 0.5rem; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center;">
                🎲
            </button>
            
            <!-- 从url导入 -->
            <button @click="if(currentMode==='cards') showImportUrlModal=true; else alert('暂不支持世界书URL导入')"
                :class="currentMode === 'cards' ? 'btn-secondary hover:scale-105' : 'opacity-50 cursor-not-allowed btn-secondary'"
                title="导入 (仅角色卡可用)" class="btn-secondary transition-all">
                🌐
            </button>
            
            <!-- 刷新页面 -->
            <button @click="currentMode === 'cards' ? fetchCards() : fetchWorldInfoList()" title="刷新" class="btn-secondary hover:scale-105 transition-transform">
                ↻
            </button>
            
            <!-- 日月切换按钮 -->
            <button @click="toggleDarkMode()" :title="isDarkMode ? '切换到浅色模式' : '切换到深色模式'" class="btn-secondary hover:scale-105 transition-transform">
                <span x-text="isDarkMode ? '🌙' : '☀️'"></span>
            </button>
            
            <!-- 设置按钮 -->
            <button @click="openSettings()" title="系统设置" class="btn-secondary hover:scale-105 transition-transform">
                ⚙️
            </button>

            <!-- 注销按钮 (仅在启用认证时显示，通常通过 session 判断，但这里前端简单通过 URL 跳转) -->
            <a href="/logout" title="退出登录" class="btn-secondary hover:scale-105 transition-transform flex items-center justify-center text-sm" style="text-decoration: none;">
                🚪
            </a>
        </div>
    </div>
</div>